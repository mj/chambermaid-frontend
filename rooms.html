<!DOCTYPE html> 
<html>
    <head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1"> 
	    <title>Single page template</title> 
	    <link rel="stylesheet" href="jquery.mobile-1.2.0.min.css" />
	    <script src="jquery-1.8.3.min.js"></script>
	    <script src="jquery.mobile-1.2.0.min.js"></script>
    </head> 

    <body> 
        <div data-role="page" id="rooms">
	        <div data-role="header">
		        <h1>Rooms</h1>
	        </div>

	        <div data-role="content">	
                <ul data-role="listview" data-inset="true" id="room-list">
                </ul>
	        </div>	
	    </div>
    </body>
    <script src="Class.js"></script>
    <script src="List.js"></script>
    <script src="Loader.js"></script>
    <script src="RoomListLoader.js"></script>

    <script type="text/javascript">
        $("#rooms").bind("pageshow", function() {
            $.mobile.showPageLoadingMsg();

            var dataHandler = function(list) {
                var items = list.getAll();
                var target = $("#room-list");

                if (items.length == 0) {
                    $.mobile.showPageLoadingMsg("a", "Unable to load list of rooms.", true);
                    return;
                }

                for (var offset in items) {
                    var room = items[offset];

                    var item = '<li id="room-' + room.id + '">'
                        + '<a href="devices.html?room=' + room.id + '">'
                        + '    ' + room.label
                        + '    <span class="ui-li-count">' + room.temperature + 'Â° C</span>'
                        + '</a>'
                        + '</li>';

                    $("#room-" + room.id).remove();
                    target.append(item);
                }

                target.listview("refresh");
                $.mobile.hidePageLoadingMsg();
            }

            var loader = new RoomListLoader(false, dataHandler);
            loader.load();
        });
    </script>
</html>
